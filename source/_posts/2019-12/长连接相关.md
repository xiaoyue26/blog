---
title: 长连接相关
date: 2019-12-29 17:22:38
tags:
- tcp
- 长连接
categories: 
- tcp

---


# WHAT: 什么是长连接
长连接: TCP， 默认不断开，用keep alive心跳包保活;
持久连接: HTTP 1.1+ keep alive, 默认断开。
短连接: 普通HTTP

# WHY: 长连接有什么好处? 为什么要使用长连接

1. 不同域名可以复用一个长连接; （HTTP不行）
2. 不依赖DNS，节省DNS开销、避免DNS劫持;（HTTP不行）
3. 减少握手时间开销；
4. 可以push消息; 

# HOW: 如何实现一个好的长连接? (难点何在)

## 难点1 长连接断开
导致断开的原因:
1. 各个环节的超时时间不匹配; -- 动态探测合适的超时时间；
2. 后台服务; -- 或者服务主备切换
3. app后台进程挂了;  -- app保活课题
3. 切换网络;  


## 实现要点
1. 处理好上述长连接断开的4个原因，保证服务质量；
2. 进行断开重连： 监控+重连。
3. 架构容灾：
{% img /images/2019-12/long_tcp.png 400 600 long_tcp %}
(1) 多地部署接入点; 
(2) 长连接失败则降级到udp\http；